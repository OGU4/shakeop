# [F-001] 「バイトの時間です」テキスト認識 — 要求仕様書

## 基本情報

| 項目 | 内容 |
|---|---|
| 管理番号 | F-001 |
| 作成日 | 2026-02-21 |
| ステータス | ✅ 完了 |
| 関連実験 | exp_001_baito_text_recognition |

## 背景・目的

サーモンランNWでは、マッチング完了後・ゲーム開始前に「バイトの時間です」という固定テキストが画面に表示される。
このテキストの有無を認識することで、ゲーム状態遷移（ロビー → ゲーム開始）の検知に利用する。

本機能はミニアプリとして実装し、ROI切り出し + pHash（パーセプチュアルハッシュ）による固定テキスト認識の精度・速度を検証する。

## 要求事項

### 必須要求 (MUST)

- サーモンランNWのゲーム画面静止画から「バイトの時間です」テキストの有無を判定できること
- 入力画像はFHD (1920x1080) 固定
- ROI座標 (x1=750, y1=545, x2=1170, y2=600) でテキスト領域を切り出すこと
- pHashによるテンプレートマッチングで認識すること
- テスト画像に対して正解率 95% 以上
- 1フレームあたりの処理時間 5ms 以内（CPU）
- 判定結果として bool（テキストの有無）と信頼度（float: 0.0-1.0）を返すこと

### 推奨要求 (SHOULD)

- pHashのリファレンス画像（テンプレート）はテスト画像のROI部分から切り出して生成する
- 閾値（ハミング距離のしきい値）を調整可能にすること
- デバッグモードでROI領域の可視化とハミング距離の表示ができること

### 将来要求 (COULD)

- 他の固定テキスト（Wave開始テキスト等）への拡張
- メインアプリ統合時の TextIdentifierProtocol 準拠

## 入出力

- **入力**: BGR画像 (1920x1080) — サーモンランNWのゲーム画面静止画
- **出力**: `(bool, float)` — (テキストの有無, 信頼度 0.0-1.0)

## ROI定義

| 項目 | 値 |
|---|---|
| 座標系 | FHD (1920x1080) 基準 |
| 形式 | (x1, y1, x2, y2) |
| 値 | (750, 545, 1170, 600) |
| 対象テキスト | 「バイトの時間です」 |

## 受け入れ基準

- [x] テスト画像（テキストあり）に対して正しく `True` を返す（正解率 95% 以上） → 100% (2/2)
- [x] テスト画像（テキストなし）に対して正しく `False` を返す（正解率 95% 以上） → 100% (2/2)
- [x] 1フレームあたりの処理時間が 5ms 以内 → 0.09ms
- [x] ミニアプリが `--image` モードで単独動作すること
- [x] 実験結果が experiments/exp_001_baito_text_recognition/README.md に記録されていること

## テストデータ

- テスト画像は手元に用意済み
- pHashテンプレートはテスト画像のROI領域から切り出して作成する

## 備考

- pHashはゲーム画面の固定テキスト認識に適している（汎用OCRはゲーム画面の独自フォント・動く背景に不向き）
- 本機能は将来的に他の固定テキスト認識にも拡張する前提で設計する
